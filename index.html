<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Money Tracker üí∞</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel (.xlsx) support -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>

<body>
    <div id="login-screen" class="login-screen" style="display: none;">
        <div class="login-card">
            <div class="login-icon">üîí</div>
            <h2>Secure Access</h2>
            <p>Please enter your numeric PIN</p>
            <div class="pin-input-group">
                <input type="password" id="login-pin" maxlength="6" pattern="\d*" inputmode="numeric"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button id="login-btn" onclick="handleLogin()">Login</button>
            </div>
            <p id="login-error" class="error-msg" style="display: none;">Invalid PIN. Please try again.</p>
        </div>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" id="tab-dashboard" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-btn" id="tab-transactions" onclick="switchTab('transactions')">Transactions</button>
            <button class="tab-btn" id="tab-settings" onclick="switchTab('settings')">Settings</button>
        </nav>

        <!-- Header -->
        <header class="header">
            <p class="subtitle">Overview</p>
            <h1>My Money Tracker</h1>
        </header>

        <!-- DASHBOARD PAGE -->
        <div id="dashboard-page" class="page active">
            <!-- Balance Card -->
            <div class="balance-card">
                <div class="balance-label">Total Net Worth</div>
                <div class="balance-amount" id="totalBalance">Rp 0</div>
                <div class="balance-details">
                    <div class="balance-item income">
                        <span class="label">Total Income</span>
                        <span class="amount" id="totalIncome">Rp 0</span>
                    </div>
                    <div class="balance-item expense">
                        <span class="label">Total Outcome</span>
                        <span class="amount" id="totalExpense">Rp 0</span>
                    </div>
                </div>
            </div>

            <!-- Daily Expense Chart -->
            <div class="summary-card">
                <div class="card-header">
                    <h2>Daily Outcome Trend</h2>
                </div>
                <div class="chart-container">
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>

            <!-- Monthly Category Charts -->
            <div class="charts-grid">
                <div class="summary-card">
                    <div class="card-header">
                        <h2>Monthly Income Breakdown</h2>
                    </div>
                    <div class="chart-container pie">
                        <canvas id="incomePieChart"></canvas>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-header">
                        <h2>Monthly Outcome Breakdown</h2>
                    </div>
                    <div class="chart-container pie">
                        <canvas id="outcomePieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Asset Summary (Rasio) -->
            <div class="summary-card">
                <div class="card-header">
                    <h2>Asset Summary (Rasio)</h2>
                </div>
                <div class="table-container">
                    <!-- IDR Assets -->
                    <div class="asset-section">
                        <h3 class="section-title idr">IDR Assets</h3>
                        <div class="table-container">
                            <table id="assetTableIDR">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Balance</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- USD Assets -->
                    <div class="asset-section">
                        <h3 class="section-title usd">USD Assets</h3>
                        <div class="table-container">
                            <table id="assetTableUSD">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>USD Balance</th>
                                        <th>Kurs</th>
                                        <th>Total IDR</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Investment Assets -->
                    <div class="asset-section">
                        <h3 class="section-title invest">Investment Assets</h3>
                        <div class="table-container">
                            <table id="assetTableInvest">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Price/Unit</th>
                                        <th>Total Value</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Net Worth Summary -->
                    <div class="net-worth-summary">
                        <span>Total Net Worth:</span>
                        <span id="totalCurrent" class="total-amount">Rp 0</span>
                    </div>
                </div>
            </div>

            <!-- Periodic Summary -->
            <div class="summary-card periodic-summary">
                <div class="periodic-item">
                    <span class="label">üóìÔ∏è This Week Outcome</span>
                    <span class="amount" id="weeklyOutcome">Rp 0</span>
                </div>
                <div class="periodic-item">
                    <span class="label">üìÖ This Month Outcome</span>
                    <span class="amount" id="monthlyOutcome">Rp 0</span>
                </div>
            </div>
        </div>

        <!-- TRANSACTIONS PAGE -->
        <div id="transactions-page" class="page">
            <!-- Add Transaction Form -->
            <div class="form-card">
                <div class="card-header">
                    <h2>Add Transaction</h2>
                </div>

                <!-- Settings moved to settings.html -->

                <form id="transactionForm">
                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <input type="text" id="description" placeholder="e.g., Lunch, Salary, Shopping" required>
                    </div>

                    <div class="form-group">
                        <label for="amount">Amount</label>
                        <input type="text" id="amount" inputmode="numeric" placeholder="0" required autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required>
                            <option value="">Select Category</option>
                            <!-- Dynamic options will be injected here -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="paymentMethod">Payment Method</label>
                        <select id="paymentMethod" required>
                            <option value="">Select Payment Method</option>
                            <!-- Dynamic options will be injected here -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Type</label>
                        <div class="type-buttons">
                            <button type="button" class="type-btn active" data-type="expense">
                                ‚ûñ Outcome
                            </button>
                            <button type="button" class="type-btn" data-type="income">
                                ‚ûï Income
                            </button>
                        </div>
                        <input type="hidden" id="type" value="expense">
                    </div>

                    <button type="submit" class="submit-btn">Add Transaction</button>
                </form>
            </div>

            <!-- Transactions List -->
            <div class="transactions-card">
                <div class="transactions-header">
                    <h2>Recent Transactions</h2>
                    <div class="header-buttons">
                        <button class="export-btn" id="exportExcel">üìä Export Excel</button>
                        <button class="clear-btn" id="clearAll">Clear All</button>
                    </div>
                </div>
                <div id="transactionsList" class="transactions-list">
                    <div class="empty-state">
                        <p>No transactions yet</p>
                        <p class="empty-subtitle">Add your first transaction above!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS PAGE -->
        <div id="settings-page" class="page">
            <div class="form-card">
                <div class="card-header">
                    <h2>Settings</h2>
                </div>
                <!-- Section 1: Excel Import -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">üìÇ</span>
                        <div>
                            <h3>Import Data</h3>
                            <p class="settings-desc">Sync from your Keuangan.xlsx file</p>
                        </div>
                    </div>
                    <label for="importConfig" class="upload-btn">
                        üìÑ Upload File...
                        <input type="file" id="importConfig" accept=".xlsx, .xls, .csv" hidden>
                    </label>
                    <div style="margin: 10px 0; text-align: center; color: var(--text-muted); font-size: 0.9rem;">- OR -
                    </div>
                    <button class="upload-btn" onclick="fetchRepoData()"
                        style="text-align: center; justify-content: center; background: var(--bca-blue); color: white; border: none; width: 100%; cursor: pointer;">
                        üì• Load from Repository (Keuangan.xlsx)
                    </button>
                </div>

                <hr class="settings-divider">

                <!-- Section 2: Security -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">üîí</span>
                        <div>
                            <h3>Security</h3>
                            <p class="settings-desc">Protect your data with a numeric PIN</p>
                        </div>
                    </div>
                    <div class="security-controls">
                        <button id="setup-pin-btn" class="upload-btn" onclick="togglePinSetup()">Setup/Change
                            PIN</button>
                        <div id="pin-setup-form" style="display: none; margin-top: 15px;">
                            <input type="password" id="new-pin" placeholder="Enter new PIN" maxlength="6"
                                style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px;">
                            <button class="upload-btn" onclick="saveNewPin()"
                                style="background: var(--bca-blue); color: white; width: 100%;">Save PIN</button>
                        </div>
                        <button id="remove-pin-btn" class="upload-btn" onclick="removePin()"
                            style="margin-top: 10px; color: #ef4444; display: none;">Remove PIN</button>

                        <div
                            style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <h4 style="margin: 0; color: var(--bca-blue); font-size: 0.95rem;">Auto-Sync Cloud
                                    </h4>
                                    <p style="margin: 5px 0 0 0; color: var(--text-muted); font-size: 0.8rem;">Sync data
                                        automatically on new devices</p>
                                </div>
                                <label class="switch"
                                    style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                    <input type="checkbox" id="auto-sync-toggle" onchange="toggleAutoSync(this)" checked
                                        style="opacity: 0; width: 0; height: 0; position: absolute;">
                                    <span
                                        style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 24px;"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- Section 2: Live Rates -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">üíπ</span>
                        <div>
                            <h3>Live Rates</h3>
                            <p class="settings-desc">Current exchange rates & asset prices</p>
                        </div>
                    </div>
                    <div class="current-rates" id="currentRatesDisplay">
                        <!-- Populated by JS -->
                    </div>
                    <div class="sync-btn-row">
                        <button class="sync-btn" id="syncKurs">üíµ USD Kurs</button>
                        <button class="sync-btn" id="syncGold">ü•á Gold</button>
                        <button class="sync-btn sync-btn-all" id="syncAll">üîÑ All</button>
                    </div>
                    <div id="syncStatus" class="sync-status">Last synced: Never</div>
                </div>
            </div>
        </div>

        <script src="assets/js/script.js"></script>
</body>

</html>